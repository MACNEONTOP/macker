{"id": "c9a179b1-8098-4c51-8808-1a25357412de", "rule_id": "ransomware-entropy-threshold-001", "name": "[Ransomware] Rapid Encryption Activity Detected (High Entropy)", "immutable": false, "rule_source": {"type": "internal"}, "version": 1, "revision": 0, "updated_at": "2025-12-15T12:33:22.773Z", "updated_by": "elastic", "created_at": "2025-12-15T12:33:22.773Z", "created_by": "elastic", "enabled": true, "interval": "2m", "from": "now-5m", "to": "now", "description": "Detects potential ransomware activity characterized by high entropy (>= 7.5) and low chi-square scores (<= 300). This rule excludes compressed files and triggers when 5 or more such events occur on a single host within a 5-minute window.", "tags": ["Ransomware", "Entropy", "Chi-Square", "macOS", "Impact", "T1486", "threat_score_1:92.0", "threat_score_1_risk_level:CRITICAL", "final_risk_score:99"], "author": ["HJ"], "license": "", "threat": [], "related_integrations": [], "required_fields": [], "setup": "", "false_positives": [], "references": [], "risk_score": 99, "risk_score_mapping": [], "severity": "critical", "severity_mapping": [], "output_index": "", "max_signals": 100, "exceptions_list": [], "actions": [], "meta": {"kibana_siem_app_url": ""}, "type": "threshold", "language": "kuery", "index": ["fsevents-*"], "query": "fsevents.file.entropy >= 7.5 and fsevents.ransomware.chi_square <= 300", "filters": [], "threshold": {"field": ["host.name.keyword", "agent.name.keyword"], "value": 5, "cardinality": []}}
{"id": "c7a65445-f154-4047-9d6e-23586231e3bc", "rule_id": "eql-infostealer-killchain-critical-002", "name": "[Sequence] macOS Infostealer Kill Chain Pattern (Information Exfiltration Attack)", "immutable": false, "rule_source": {"type": "internal"}, "version": 1, "revision": 0, "updated_at": "2025-12-15T12:33:22.742Z", "updated_by": "elastic", "created_at": "2025-12-15T12:33:22.742Z", "created_by": "elastic", "enabled": true, "interval": "5m", "from": "now-65m", "to": "now", "description": "Detected when Discovery → Collection → Exfiltration stage alerts occur sequentially on the same host within 20 minutes. InfoStealers typically complete their data theft cycle very quickly (often under 1 minute), but 20-minute window accounts for detection delays and log processing time.", "tags": ["Infostealer_Pattern", "Kill_Chain", "attack.discovery", "attack.collection", "attack.exfiltration", "macOS", "threat_score_1:92.0", "threat_score_1_risk_level:CRITICAL", "final_risk_score:98"], "author": ["june0320"], "threat": [], "related_integrations": [], "required_fields": [], "setup": "", "false_positives": [], "references": [], "risk_score": 98, "risk_score_mapping": [], "severity": "critical", "severity_mapping": [], "output_index": "", "max_signals": 100, "exceptions_list": [], "actions": [], "type": "eql", "language": "eql", "index": [".internal.alerts-security.alerts-default-*"], "query": "sequence by host.name with maxspan=20m\n  [any where kibana.alert.rule.tags : \"attack.discovery\"]\n  [any where kibana.alert.rule.tags : \"attack.collection\"]\n  [any where kibana.alert.rule.tags : \"attack.exfiltration\"]", "filters": []}
{"id": "dcf5c9bc-2ed6-40c8-b3a3-484fb4bd4e07", "rule_id": "eql-malware-killchain-high-risk-001", "name": "[Sequence] macOS Malware Kill Chain Pattern (Malware Kill Chain Pattern)", "immutable": false, "rule_source": {"type": "internal"}, "version": 1, "revision": 3, "updated_at": "2025-12-15T16:31:11.721Z", "updated_by": "elastic", "created_at": "2025-12-15T12:33:22.801Z", "created_by": "elastic", "enabled": true, "interval": "5m", "from": "now-65m", "to": "now", "description": "Detected when Initial Access → Execution → Persistence stage alerts occur sequentially on the same host within 1 hour, with each alert's risk_score being high or above.", "tags": ["Malware_Pattern", "Kill_Chain", "High_Risk", "attack.initial_access", "attack.execution", "attack.persistence", "threat_score_1:92.0", "threat_score_1_risk_level:CRITICAL", "final_risk_score:95"], "author": ["HJ"], "license": "", "threat": [], "related_integrations": [], "required_fields": [], "setup": "", "false_positives": [], "references": [], "risk_score": 95, "risk_score_mapping": [], "severity": "critical", "severity_mapping": [], "output_index": "", "max_signals": 100, "exceptions_list": [], "actions": [], "meta": {"kibana_siem_app_url": ""}, "type": "eql", "language": "eql", "index": [".internal.alerts-security.alerts-default-*"], "query": "sequence by host.name with maxspan=60m\n  [any where (kibana.alert.rule.tags : \"attack.execution\" and kibana.alert.risk_score >= 41) or (kibana.alert.rule.name: \"User Execution Malicious File\")]\n  [any where kibana.alert.rule.tags : \"attack.persistence\" and kibana.alert.risk_score >= 41]", "filters": []}
{"id": "491157d1-94ba-4764-9c85-25fc67b4cf88", "rule_id": "threshold-003-credential-spike-v2", "name": "[Threshold] macOS Credential Access Spike", "immutable": false, "rule_source": {"type": "internal"}, "version": 1, "revision": 1, "updated_at": "2025-12-15T15:22:59.391Z", "updated_by": "elastic", "created_at": "2025-12-15T12:33:22.778Z", "created_by": "elastic", "enabled": true, "interval": "5m", "from": "now-6m", "to": "now", "description": "Detects when Credential Access related alerts occur 5 or more times within 5 minutes. Indicates sustained credential harvesting attempts and identifies attack activities aimed at account takeover.", "tags": ["attack.credential_access", "Meta_Alert", "threat_score_1:68.0", "threat_score_1_risk_level:HIGH", "final_risk_score:70"], "author": ["HJ"], "license": "", "threat": [], "related_integrations": [], "required_fields": [], "setup": "", "false_positives": [], "references": [], "risk_score": 85, "risk_score_mapping": [], "severity": "critical", "severity_mapping": [], "output_index": "", "max_signals": 100, "exceptions_list": [], "actions": [], "meta": {"kibana_siem_app_url": ""}, "type": "threshold", "language": "kuery", "index": [".internal.alerts-security.alerts-default-*"], "query": "kibana.alert.rule.tags: \"attack.credential_access\"", "filters": [], "threshold": {"field": ["host.name"], "value": 5, "cardinality": []}}
{"id": "3f3f2ada-0ce5-478c-9c72-3808cb0dd63e", "rule_id": "threshold-001-discovery-storm-v3", "name": "[Threshold] macOS System Information Gathering Activity", "immutable": false, "rule_source": {"type": "internal"}, "version": 1, "revision": 5, "updated_at": "2025-12-15T14:34:54.600Z", "updated_by": "elastic", "created_at": "2025-12-15T12:33:22.758Z", "created_by": "elastic", "enabled": true, "interval": "2m", "from": "now-5m", "to": "now", "description": "Detects when 7 or more discovery alerts occur using 3 or more different discovery techniques within 3 minutes. Identifies systematic reconnaissance performed through various methods: System Info (sw_vers, scutil), Network Config (ipconfig), Time Discovery (systemsetup), Remote System Discovery (netstat).", "tags": ["attack.discovery", "threat_score_1:50.5", "threat_score_1_risk_level:MEDIUM", "final_risk_score:50"], "author": ["HJ"], "license": "", "threat": [], "related_integrations": [], "required_fields": [], "setup": "", "false_positives": [], "references": [], "risk_score": 82, "risk_score_mapping": [], "severity": "critical", "severity_mapping": [], "output_index": "", "max_signals": 100, "exceptions_list": [], "actions": [], "meta": {"kibana_siem_app_url": ""}, "type": "threshold", "language": "kuery", "index": [".internal.alerts-security.alerts-default-*"], "query": "kibana.alert.rule.name: (\"System Information Discovery via sw_vers\" OR \"System Information Discovery via scutil\" OR \"System Time Discovery via systemsetup\" OR \"System Network Configuration Discovery via ipconfig getiflist\" OR \"Remote System Discovery via netstat\")", "filters": [], "threshold": {"field": ["host.name"], "value": 7, "cardinality": [{"field": "kibana.alert.rule.name", "value": 3}]}}
{"id": "ce91df4b-dd54-4501-ad4c-0f927a7dd8e7", "rule_id": "threshold-004-high-risk-cluster-v3", "name": "[Threshold] macOS High Risk Alert Cluster (Risk-Based Detection)", "immutable": false, "rule_source": {"type": "internal"}, "version": 1, "revision": 0, "updated_at": "2025-12-15T12:33:22.799Z", "updated_by": "elastic", "created_at": "2025-12-15T12:33:22.799Z", "created_by": "elastic", "enabled": true, "interval": "10m", "from": "now-11m", "to": "now", "description": "Risk-based alerting: Multiple alerts (3 or more) with MEDIUM or above risk level occurred within 10 minutes, from at least 2 different detection rules. Excludes LOW severity alerts to focus on actionable threats. Based on Splunk and Elastic risk scoring methodologies.", "tags": ["Risk_Based_Detection", "threat_score_1:75.0", "threat_score_1_risk_level:HIGH", "final_risk_score:85"], "author": ["HJ"], "threat": [], "related_integrations": [], "required_fields": [], "setup": "", "false_positives": [], "references": [], "risk_score": 85, "risk_score_mapping": [], "severity": "high", "severity_mapping": [], "output_index": "", "max_signals": 100, "exceptions_list": [], "actions": [], "type": "threshold", "language": "kuery", "index": [".internal.alerts-security.alerts-default-*"], "query": "threat_score_1_risk_level: (\"CRITICAL\" OR \"HIGH\" OR \"MEDIUM\")", "filters": [], "threshold": {"field": ["host.name", "agent.name.keyword"], "value": 3, "cardinality": [{"field": "kibana.alert.rule.name", "value": 2}]}}
{"id": "a6bc8085-e769-4901-a938-109b39aeb126", "rule_id": "threshold-lateral-movement-001", "name": "[Threshold] macOS Lateral Movement Indicators (Internal Network Propagation)", "immutable": false, "rule_source": {"type": "internal"}, "version": 1, "revision": 2, "updated_at": "2025-12-15T14:19:26.127Z", "updated_by": "elastic", "created_at": "2025-12-15T12:33:22.763Z", "created_by": "elastic", "enabled": true, "interval": "1m", "from": "now-2m", "to": "now", "description": "Lateral movement detected: Either (1) Network reconnaissance tools (netstat/lsof) executed 5+ times within 1 minute, OR (2) Remote access attempts (SSH/VNC) occurred 3+ times within 1 minute. Uses specific detection rules: 'Remote System Discovery via netstat', 'System Network Connections Discovery via lsof', 'External Remote Services via ssh', 'VNC'.", "tags": ["attack.lateral_movement", "threat_score_1:75.0", "threat_score_1_risk_level:HIGH", "final_risk_score:80"], "author": ["HJ"], "license": "", "threat": [], "related_integrations": [], "required_fields": [], "setup": "", "false_positives": [], "references": [], "risk_score": 80, "risk_score_mapping": [], "severity": "high", "severity_mapping": [], "output_index": "", "max_signals": 100, "exceptions_list": [], "actions": [], "meta": {"kibana_siem_app_url": ""}, "type": "threshold", "language": "kuery", "index": [".internal.alerts-security.alerts-default-*"], "query": "kibana.alert.rule.name: (\"Remote System Discovery via netstat\" OR \"System Network Connections Discovery via lsof\")  OR kibana.alert.rule.name: (\"External Remote Services via ssh\" OR \"VNC\") ", "filters": [], "threshold": {"field": ["host.name"], "value": 3, "cardinality": []}}
{"id": "a43bad98-503d-4a5f-b6e4-12b1c323b01c", "rule_id": "threshold-persistence-attempts-001", "name": "[Threshold] macOS Multi-Vector Persistence Establishment", "immutable": false, "rule_source": {"type": "internal"}, "version": 1, "revision": 1, "updated_at": "2025-12-15T14:48:48.841Z", "updated_by": "elastic", "created_at": "2025-12-15T12:33:21.860Z", "created_by": "elastic", "enabled": true, "interval": "1m", "from": "now-11m", "to": "now", "description": "Detects when 2 or more persistence mechanisms are established using different techniques within 10 minutes. Attackers often use multiple persistence methods (e.g., LaunchAgents, Login Items) simultaneously to ensure survival after system reboot.", "tags": ["attack.persistence", "threat_score_1:68.0", "threat_score_1_risk_level:HIGH", "final_risk_score:75"], "author": ["HJ"], "license": "", "threat": [], "related_integrations": [], "required_fields": [], "setup": "", "false_positives": [], "references": [], "risk_score": 90, "risk_score_mapping": [], "severity": "critical", "severity_mapping": [], "output_index": "", "max_signals": 100, "exceptions_list": [], "actions": [], "meta": {"kibana_siem_app_url": ""}, "type": "threshold", "language": "kuery", "index": [".internal.alerts-security.alerts-default-*"], "query": "kibana.alert.rule.tags: \"attack.persistence\"", "filters": [], "threshold": {"field": ["host.name"], "value": 2, "cardinality": [{"field": "kibana.alert.rule.name", "value": 2}]}}
{"id": "3e66123e-07f4-4409-a610-afa47fdb2207", "rule_id": "threshold-privilege-escalation-001", "name": "[Threshold] macOS Privilege Escalation Attempts", "immutable": false, "rule_source": {"type": "internal"}, "version": 1, "revision": 1, "updated_at": "2025-12-15T15:07:49.483Z", "updated_by": "elastic", "created_at": "2025-12-15T12:33:22.768Z", "created_by": "elastic", "enabled": true, "interval": "1m", "from": "now-11m", "to": "now", "description": "Detects when 2 or more different privilege escalation techniques are attempted within 5 minutes. Identifies attackers trying multiple privilege escalation vectors to gain administrative privileges.", "tags": ["attack.privilege_escalation", "threat_score_1:68.0", "threat_score_1_risk_level:HIGH", "final_risk_score:70"], "author": ["HJ"], "license": "", "threat": [], "related_integrations": [], "required_fields": [], "setup": "", "false_positives": [], "references": [], "risk_score": 88, "risk_score_mapping": [], "severity": "critical", "severity_mapping": [], "output_index": "", "max_signals": 100, "exceptions_list": [], "actions": [], "meta": {"kibana_siem_app_url": ""}, "type": "threshold", "language": "kuery", "index": [".internal.alerts-security.alerts-default-*"], "query": "kibana.alert.rule.tags: \"attack.privilege_escalation\"", "filters": [], "threshold": {"field": ["host.name"], "value": 2, "cardinality": [{"field": "kibana.alert.rule.name", "value": 2}]}}
{"id": "0ad43e88-cb15-41b1-af22-4340fc1401c4", "rule_id": "threshold-005-ssh-brute-force", "name": "[Threshold] macOS SSH Brute Force Attack (10 Failures) Detection", "immutable": false, "rule_source": {"type": "internal"}, "version": 1, "revision": 0, "updated_at": "2025-12-15T12:33:22.785Z", "updated_by": "elastic", "created_at": "2025-12-15T12:33:22.785Z", "created_by": "elastic", "enabled": true, "interval": "1m", "from": "now-11m", "to": "now", "description": "Credential Access alerts occurred 2 or more times within 5 minutes on a single host (target server) due to SSH brute force attack. Each alert represents 5 failed attempts, so 2 alerts = 10 total failures. Immediate response required.", "tags": ["attack.credential_access", "Brute_Force_SSH", "threat_score_1:68.0", "threat_score_1_risk_level:HIGH", "final_risk_score:75"], "author": ["HJ"], "license": "", "threat": [], "related_integrations": [], "required_fields": [], "setup": "", "false_positives": [], "references": [], "risk_score": 75, "risk_score_mapping": [], "severity": "high", "severity_mapping": [], "output_index": "", "max_signals": 100, "exceptions_list": [], "actions": [], "meta": {"kibana_siem_app_url": ""}, "type": "threshold", "language": "kuery", "index": ["mac-*"], "query": "aul.processImagePath:\"sshd-session\" AND aul.formatString:\"%.500s\" AND (aul.eventMessage:\"error: maximum authentication attempts exceeded for\")", "filters": [], "threshold": {"field": ["agent.name.keyword", "host.name.keyword"], "value": 2, "cardinality": []}}
{"id": "9560c012-99bf-4f2b-bd22-0aeac04fe686", "rule_id": "2177b63d-1156-463c-9f60-47d182adf393", "name": "Process Discovery via ps", "immutable": false, "rule_source": {"type": "internal"}, "version": 1, "revision": 0, "updated_at": "2025-12-15T12:33:22.752Z", "updated_by": "elastic", "created_at": "2025-12-15T12:33:22.752Z", "created_by": "elastic", "enabled": true, "interval": "5m", "from": "now-6m", "to": "now", "description": "Detects execution of the 'ps' command to enumerate running processes on macOS. Aggregates logs by TraceID to prevent noise.", "tags": ["attack.discovery", "attack.t1057", "threat_score_1:50.5", "threat_score_1_risk_level:MEDIUM", "threat_score_2:4.0", "final_risk_score:47"], "author": ["HJ"], "threat": [{"framework": "MITRE ATT&CK", "tactic": {"id": "TA0007", "name": "Discovery", "reference": "https://attack.mitre.org/tactics/TA0007/"}, "technique": [{"id": "T1057", "name": "Process Discovery", "reference": "https://attack.mitre.org/techniques/T1057/"}]}], "related_integrations": [], "required_fields": [], "setup": "", "false_positives": ["Legitimate administrative usage for debugging or system monitoring", "Developer commands executed in terminal sessions"], "references": ["https://attack.mitre.org/techniques/T1057/"], "risk_score": 47, "risk_score_mapping": [], "severity": "medium", "severity_mapping": [], "output_index": "", "max_signals": 100, "exceptions_list": [], "actions": [], "meta": {"from": "1m", "kibana_siem_app_url": "/app/security"}, "type": "threshold", "language": "kuery", "index": ["mac-*"], "query": "aul.processImagePath:\"/bin/ps\" AND aul.eventMessage:\"Retrieve User by ID\"", "filters": [], "threshold": {"field": ["aul.traceID", "agent.name.keyword"], "value": 1}}