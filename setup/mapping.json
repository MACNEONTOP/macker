  {
    "runtime": {
      "threat_score_1": {
        "type": "double",
        "script": {
          "source": "if (doc['kibana.alert.rule.tags'].size() > 0) { for (tag in doc['kibana.alert.rule.tags']) { if (tag.startsWith('threat_score_1:')) { emit(Double.parseDouble(tag.substring(15))) } } }"
        }
      },
      "threat_score_1_risk_level": {
        "type": "keyword",
        "script": {
          "source": "if (doc['kibana.alert.rule.tags'].size() > 0) { for (tag in doc['kibana.alert.rule.tags']) { if (tag.startsWith('threat_score_1_risk_level:')) { emit(tag.substring(26)) } } }"
        }
      },
      "threat_score_2": {
        "type": "double",
        "script": {
          "source": "if (doc['kibana.alert.rule.tags'].size() > 0) { for (tag in doc['kibana.alert.rule.tags']) { if (tag.startsWith('threat_score_2:')) { emit(Double.parseDouble(tag.substring(15))) } } }"
        }
      },
      "final_risk_score": {
        "type": "long",
        "script": {
          "source": "if (doc['kibana.alert.rule.tags'].size() > 0) { for (tag in doc['kibana.alert.rule.tags']) { if (tag.startsWith('final_risk_score:')) { emit(Long.parseLong(tag.substring(17))) } } }"
        }
      },
      "threat_score_1_risk_level_numeric": {
        "type": "long",
        "script": {
          "source": "if (doc['kibana.alert.rule.tags'].size() > 0) { for (tag in doc['kibana.alert.rule.tags']) { if (tag.startsWith('threat_score_1_risk_level:')) { String level = tag.substring(26); if (level.equals('CRITICAL')) emit(4); else if (level.equals('HIGH')) emit(3); else if (level.equals('MEDIUM')) emit(2); else if (level.equals('LOW')) emit(1); } } }"
        }
      },
      "host.name": {
        "type": "keyword",
        "script": {
          "source": "String h=null;if(doc.containsKey('kibana.alert.threshold_result.terms.value')&&!doc['kibana.alert.threshold_result.terms.value'].empty){h=doc['kibana.alert.threshold_result.terms.value'][0];}if(h==null&&doc.containsKey('host.name.keyword')&&!doc['host.name.keyword'].empty){h=doc['host.name.keyword'].value;}if(h==null&&doc.containsKey('host.hostname.keyword')&&!doc['host.hostname.keyword'].empty){h=doc['host.hostname.keyword'].value;}if(h==null&&doc.containsKey('agent.name.keyword')&&!doc['agent.name.keyword'].empty){h=doc['agent.name.keyword'].value;}if(h!=null){emit(h.toLowerCase());}"
        }
      }
    }
  }

