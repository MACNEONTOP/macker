# input {
# 	beats {
# 		port => 5044
# 	}

# 	tcp {
# 		port => 50000
# 	}
# }

# ## Add your filters / logstash plugins configuration here

# output {
# 	elasticsearch {
# 		hosts => "elasticsearch:9200"
# 		user => "logstash_internal"
# 		password => "${LOGSTASH_INTERNAL_PASSWORD}"
# 	}
# }

input {
  beats {
    # Docker 내부에서는 5044가 표준입니다. (docker-compose 포트 매핑과 일치)
    port => 5044
    host => "0.0.0.0"
  }
}

filter {
  # 보내주신 필터 로직은 그대로 유지합니다.
  json {
    source => "message"
    target => "aul"
  }

  date {
    match => [ 
      "[aul][timestamp]", 
      "yyyy-MM-dd HH:mm:ss.SSSSSSZ", 
      "ISO8601" 
    ]
    target => "@timestamp"
  }
 
  mutate {
    remove_field => ["message"]
  }
}

output {
  elasticsearch {
    # 1. 호스트 수정: Docker 내부에서 localhost는 자기 자신입니다. 
    # Elasticsearch 컨테이너 이름인 "elasticsearch"를 써야 합니다.
    hosts => ["elasticsearch:9200"]
    
    # 2. 인덱스 이름
    index => "my-mac-%{+YYYY.MM.dd}"
    
    # 3. 계정 수정: docker-elk 템플릿의 내부 통신용 계정을 사용합니다.
    user => "logstash_internal"
    password => "${LOGSTASH_INTERNAL_PASSWORD}"
    
    # 4. SSL/인증서 수정 (가장 중요!)
	# ---------------------------------------------------------
    # [수정됨] 에러 해결을 위한 SSL 설정 변경
    # ---------------------------------------------------------
    ssl_enabled => false
    # 예전 방식 (삭제됨): ssl_certificate_verification => false
    # 최신 방식: "none"이라고 적어야 인증서 검증을 건너뜁니다.
    # ssl_verification_mode => "none"
    # ---------------------------------------------------------
  	}
  # 디버깅용 (나중에 주석 처리 하세요)
  stdout { codec => rubydebug }
}